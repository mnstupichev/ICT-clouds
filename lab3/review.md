# Лабораторная 3

## Описание
1. Написать “плохой” CI/CD файл, который работает, но в нем есть не менее трех “bad practices” по написанию CI/CD.
2. Написать “хороший” CI/CD, в котором эти плохие практики исправлены.
3. В Readme описать каждую из плохих практик в плохом файле, почему она плохая и как в хорошем она была исправлена, как исправление повлияло на результат.

## Этапы выполнения 
### 0. Анализ работы
Чтобы начать что-то делать, нужно опять понять что это за страшные буквы и что с ними делать. Что такое CI/CD я относительно понимаю, так что я узнал какие плохие практики существуют. Так как я 
разочаровался в Deepseek (со временем он стал делать хуже буквально все, собирать информацию в том числе), так что теперь я использую Gemini. Самые распространенные ошибки по его мнению это: 
* делать образ последней версии, а не определенной
* делать все действия в одной стадии
* оставлять пароли в коде (иногда бывает, что сначала лень делать переменную для пароля, а потом просто забываешь)
 
Что делать вроде понятно, так что приступим.

### 1. Написание плохого файла

Создал репозиторий на Gitlab и добавил максимально простой код для тестирования наешго CI/CD.
<img width="1383" height="333" alt="image" src="https://github.com/user-attachments/assets/c722ec63-4805-4802-b235-69b129e007c1" />

Теперь создадим уже сам файл для деплоя: 
<img width="1158" height="377" alt="image" src="https://github.com/user-attachments/assets/380a6967-b653-46cf-a0e4-0edd610e7790" />

Запушим его и задеплоим уже на сайте Gitlab:
<img width="1821" height="575" alt="image" src="https://github.com/user-attachments/assets/2827359e-16f4-481f-984d-c1235337ee1d" />

<img width="300" height="300" alt="image" src="https://github.com/user-attachments/assets/e80602ad-e7a0-4571-bdd2-14e386804ba6" />

Вообщем, так как я впервые пользуюсь деплоем на Gitlab, мне сказали подтвердить телефон или карту, но ни то ни другое не получилось.
Потратил полчаса на прохождение сложнейших капч.

Попытаемся задеплоить в Github: 
После еще получаса переноса в Github, осознал что в Github нужен немного другой синтаксис для .yml файла, так что переделал его.
<img width="963" height="657" alt="image" src="https://github.com/user-attachments/assets/4d876c54-25de-44c2-8e43-03b858b2e42e" />

Все запустилось, но я подумал, что с паролем совсем неинтересная уязвимость, так что сделал с скачиванием скриптов из интернета, что плохо, так как сайт, с которого ты скачиваешь могут 
взломать (ну или просто даже изменить):
<img width="1128" height="649" alt="image" src="https://github.com/user-attachments/assets/0dbecb14-5b74-42b6-a90a-fa667b31956a" />

После небольших страданий (нашел еще одну плохую практику: без использования ```setup-python``` пути к библиотекам (PATH) не настроены), все задеплоилось: 

<img width="468" height="513" alt="image" src="https://github.com/user-attachments/assets/ea243b0d-c85f-4e1b-939a-4d86e5b89b9a" />

<img width="1799" height="700" alt="image" src="https://github.com/user-attachments/assets/d2a5b1e5-6187-4354-999d-90d260870462" />

### 2. Написание хорошего файла

Заменим плохой файл на хороший:
<img width="884" height="870" alt="image" src="https://github.com/user-attachments/assets/b5e1968f-04c1-41e0-a798-5c4c1d61b36f" />

Все задеплоилось с первого раза!: 
<img width="787" height="424" alt="image" src="https://github.com/user-attachments/assets/2d498052-fa68-47d5-9a42-477df8a462ed" />

### 3. Сравнение практик в файлах

| Плохая практика | Почему это плохо? | Как исправлено |
| :--- | :--- | :--- |
| **Использование `ubuntu-latest`** | При обновлении GitHub версии ОС проект может сломаться из-за несовместимости системных библиотек. | Указана жесткая версия `ubuntu-22.04`, что гарантирует идентичность окружения при каждом запуске. |
| **Один Job (Всё в одном)** | Если шаг установки Docker упадет, GitHub пометит всю задачу как проваленную. Невозможно понять с первого взгляда: проблема в коде (тестах) или в инфраструктуре. | Пайплайн разделен на `test` и `deploy`. Теперь визуально понятно, на каком этапе произошел сбой. |
| **Установка Docker через `curl \| sh`** | 1. **Безопасность:** Запуск скрипта с правами `sudo` напрямую из сети. Если злоумышленники подменят файл на сервере Docker, они получат контроль над сборкой. <br> 2. **Избыточность:** В образах GitHub Actions Docker уже предустановлен. Повторная установка тратит 1-2 минуты времени при каждом пуше. | Команда установки удалена. Вместо неё используются встроенные возможности окружения, что безопаснее и быстрее. |
| **Ошибка `ModuleNotFound: pytest (с чем я сталкнулся)`** | Без использования `setup-python` пути к библиотекам (PATH) не настроены. Приходится использовать обходные пути типа `python3 -m pip`, что неудобно и ненадежно. | Экшен `actions/setup-python` автоматически изолирует среду и настраивает все системные пути. |
